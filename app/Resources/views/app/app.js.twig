
var file_init_upload_url = '{{ url('file.init-upload', {
		sha1: '__sha1__',
		size: '__size__'
	})|raw }}';
	
var file_chunk_upload_url = '{{ url('file.uploadchunk', {
		sha1: '__sha1__'
	})|raw }}';
	
var data_link_url = '{{ url('data.link', {key: '__object_key__'})|raw }}';

var object_search_url = '{{ url('elasticsearch.api.search')|raw }}';

function luma(color) // color can be a hx string or an array of RGB values 0-255
{
    var rgb = (typeof color === 'string') ? hexToRGBArray(color) : color;
    return (0.2126 * rgb[0]) + (0.7152 * rgb[1]) + (0.0722 * rgb[2]); // SMPTE C, Rec. 709 weightings
}

function hexToRGBArray(color)
{
    if (color.length === 3)
        color = color.charAt(0) + color.charAt(0) + color.charAt(1) + color.charAt(1) + color.charAt(2) + color.charAt(2);
    else if (color.length !== 6)
        throw('Invalid hex color: ' + color);
    var rgb = [];
    for (var i = 0; i <= 2; i++)
        rgb[i] = parseInt(color.substr(i * 2, 2), 16);
    return rgb;
}



$(document).ready(function() {
    //Initialize Select2 Elements
    $(".select2").select2({
    	escapeMarkup: function (markup) { return markup; }
    });
    
    //Function to update the cluster status
	var updateStatusFct = function(){
		$.getJSON( "{{ url('elasticsearch.status')|raw }}.json" )
		  .done(function( json ) {
			  $('#status-overview').html(json.body);
		  })
		  .fail(function( jqxhr, textStatus, error ) {
			var err = textStatus + ", " + error;
			$('#status-overview').html('<i class="fa fa-circle text-red"></i> ' + err);
		  });
	};	

 	//cron to update the cluster status
	updateStatusFct();
	window.setInterval(function(){
		updateStatusFct();
	}, 60000);
	//60000 every minute
	
	
	//try to find wich sidemenu elements to activate
	if (typeof side_menu_target !== 'undefined') { 
    	$('#'+side_menu_target).parents('li').addClass('active');
	} 
	
	/*$('input.datepicker').each(function( index ) {
	  console.log( $(this).attr('data-date-format') );
	  $(this).datepicker({
	    format: $(this).attr('data-date-format'),
	    todayBtn: true
	  })
	});*/
		
	if(typeof(Storage) !== "undefined") {
		var sidebarExpanded = localStorage.getItem("ems/sidebarExpanded");
		if(sidebarExpanded == null){
			sidebarExpanded = true;
			localStorage.setItem("ems/sidebarExpanded", 1);   	
		}
		else if(!Number(sidebarExpanded)){
			$('body').addClass('sidebar-collapse');
		}
		
		$("#sidebar-toggle-button").click(function(event){
			var sidebarExpanded = Number(localStorage.getItem("ems/sidebarExpanded"));
			console.log(sidebarExpanded?0:1);
			
			localStorage.setItem("ems/sidebarExpanded", sidebarExpanded?0:1);  
		});
		
		
	} else {
   		//console.log("Sorry! No Web Storage support.");
	}
	
	
	$('.toggle-button').click(function(){ 
	    var toggleTex = $(this).data('toggle-contain');
	    var text=$(this).html();
	    $(this).html(toggleTex);
		$(this).data('toggle-contain', text);
	});


	function getUrlParameter(sParam) {
	    var sPageURL = decodeURIComponent(window.location.search.substring(1)),
	        sURLVariables = sPageURL.split('&'),
	        sParameterName,
	        i;

	    for (i = 0; i < sURLVariables.length; i++) {
	        sParameterName = sURLVariables[i].split('=');
	        if (sParameterName[0] === sParam) {
	            return sParameterName[1] === undefined ? true : sParameterName[1];
	        }
	    }
	};

    $('a[id*="menu-data-view"]').on('click', function() {
    	// Get the id of the menu item
        var pageNumber = $(this).attr('href').split("/");
        pageNumber = pageNumber.pop();
        
        // SessionStorage allowed in browser
        if (typeof sessionStorage != "undefined") {
            sessionStorage.setItem("calbe_session", pageNumber);
        }
    });

    // Item menu "By institutions" must be always active after we have choose an institution.
    if( getUrlParameter('search_form[filters][0][field]') === 'institutions') {
        if (typeof sessionStorage != "undefined") {
            
            if ("calbe_session" in sessionStorage) {
                var currentPage = sessionStorage.getItem("calbe_session");
	            if (typeof currentPage != 'undefined') {
	            	$("ul.treeview-menu li").removeClass('active');
	            	$("ul.treeview-menu").find( 'a[href*="/custom-index-view/' + currentPage +'"]').parent('li').addClass('active');
	            }
        	}
        }
    }

   
	
});

$(window).load(function() {
	$("img.lazy").show().lazyload({
	    effect : "fadeIn",
	    threshold : 200
	});
	

});



