{{ form_start(treatform) }}

		{% if notifications|length <= 0  %}
			<p>{{ 'No result for this filters combinaison'|trans }}: <a href="{{ url('notifications.inbox') }}">{{ 'reset filters' }}</a></p>
		{% else %}
				
		<div class="table-responsive">
		<table class="table table-condensed table-striped">
			<tbody>
				<tr>
					<th class="" style="">
	                  	<a href="#" onclick="javascript: $('.item-to-treat').prop('checked', 'checked'); return false;"><i class="fa fa-check-square-o"></i></a> 
	                  	<a href="#" onclick="javascript: $('.item-to-treat').prop('checked', false); return false;"><i class="fa fa-square-o"></i></a>
	                  	&nbsp;Notification
					</th>
					<th>Create by</th>
					<th>Date</th>
					<th>Environment</th>
					<th>Warnings</th>
					<th>Revision</th>
					<th>Actions</th>
				</tr>
			</tbody>
			{% for notification in notifications %}
				<tr>
					<td class="" nowrap="nowrap">
						<label id="treat_notifications_notifications_{{ notification.id }}_label">
							&nbsp;&nbsp;&nbsp;<input class="item-to-treat" type="checkbox" id="treat_notifications_notifications_{{ notification.id }}" name="treat_notifications[notifications][{{ notification.id }}]" label="treat_notifications_notifications_{{ notification.id }}_label" value="{{ notification.id }}">
							&nbsp;&nbsp;&nbsp;<i class="fa {{notification.template.icon}}"></i> {{ notification.template.name }}
						</label>
					
					
{# 								{{ form_widget(attribute(treatform.notifications, notification.id)) }}#}
					</td>
{# 							<td><i class="fa {{notification.template.icon}}"></i> {{ notification.template.name }}</td>#}
					<td>{{ notification.username }}</td>
					<td>{{ notification.created|date|date(date_time_format) }}</td>
					<td>
						<span class="badge bg-{{ notification.environment.color|raw }}">{{ notification.environment.name }}</span>
					</td>
					<td>
					{% set found = false %}
					{% for env in notification.revision.environments %}
						{% if env == notification.environment %}
							{% set found = true %}
						{% endif %}
					{% endfor %}
					{% if not found and notification.counter > 1 %}
						<i class="fa fa-warning  text-{{ notification.revision.contentType.color }}" title=" This revision is not published in {{ notification.name }} anymore and another notification exists"></i> This revision is not published in {{ notification.environment.name }} anymore and another notification exists
					{% elseif not found %}
						<i class="fa fa-warning  text-{{ notification.revision.contentType.color }}" title="This revision is not published in {{ notification.environment.name }} anymore"></i> This revision is not published in {{ notification.environment.name }} anymore
					{% elseif notification.counter > 1 %}
						<i class="fa fa-warning  text-{{ notification.revision.contentType.color }}" title="At least another notification exists for this object"></i> At least another notification exists for this object
					{% else %}
						<i class="fa fa-thumbs-up  text-{{ notification.revision.contentType.color }}"></i>
					{% endif %}
					&nbsp;
					</td>
					<td>
						{{ (notification.revision.contentType.name~':'~notification.revision.ouuid)|data_link(notification.revision.id)|raw }}

					<td>
						<div class="btn-group">
							<button onclick="javascript: $('.item-to-treat').prop('checked', false); $('#treat_notifications_notifications_{{ notification.id }}').prop('checked', 'checked'); return false;" type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#treatNotificationsModal">
							  <i class="fa fa-gear"></i> Treat
							</button>
							{% include 'elements/object-views-button.html.twig' with { 
								'object':  notification.revision.buildObject,
								'contentType': notification.revision.contentType,
								'environment': notification.environment,
								'ouuid': notification.revision,
								'currentTemplate': notification.template
							}%}
	                    </div>
	         
					</td>
				</tr>
			{% endfor %}
		</table>
		</div>
	<div class="">
		<div class="btn-group">					
			<button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#treatNotificationsModal">
			  <i class="fa fa-gear"></i> Treat selection
			</button>
		</div>
		{% endif %}
	</div>
	


	<!-- Modal -->
	<div class="modal fade" id="treatNotificationsModal" tabindex="-1" role="dialog" aria-labelledby="treatNotificationsModalLabel">
	  <div class="modal-dialog" role="document">
	    <div class="modal-content">
	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	        <h4 class="modal-title" id="treatNotificationsModalLabel">Treat selected notifications</h4>
	      </div>
	      <div class="modal-body">
      		{{ form_row(treatform.response) }}
{#       		{{ form_row(treatform.unpublishFrom) }}#}
      		{{ form_row(treatform.publishTo) }}
	      </div>
	      <div class="modal-footer">
	      
			<div class="btn-group">
              	{{ form_widget(treatform.accept) }}		
              	{{ form_widget(treatform.reject) }}
			</div>
	      </div>
	    </div>
	  </div>
	</div>
		
	{{ form_widget(treatform.notifications) }}
{{ form_end(treatform) }}