{% extends 'base.html.twig' %}

{% block title %}All Environments{% endblock %}
{% block pagetitle %}All Environments{% endblock %} 


{% block body %}

<div class="row">
	<div class="col-md-8">
		<div class="box ">
			<div class="box-header with-border">
				<i class="fa fa-database"></i>
				<h3 class="box-title">Environments</h3>
				<a class="btn btn-xs btn-primary pull-right" href="{{ url('environment.add') }}"><i class="fa fa-plus"></i> </a>
			</div>
			<!-- /.box-header -->
			<div class="box-body">
				{% if environments|length == 0 %}
					There is no environment yet
				{% else %}
				<table class="table table-condensed table-striped">
					<tbody>
						<tr>
							<th class="text-center" style="width: 10px">#</th>
							<th>Name</th>
							<th>Index</th>
							<th class="text-center">Total (index)</th>
							<th class="text-center">Total (eMS)</th>
							<th>Action</th>
						</tr>
						{% for environment in environments %}
							<tr>
								<td class="text-center">{{ loop.index }}.</td>
								<td>{{ environment.name }}</td>
								<td>{{ environment.index }}</td>
								<td class="text-center">{{ environment.total|number_format }}</td>
								<td class="text-center">{{ environment.revisions|length|number_format }}</td>
								<td>
									<div class="btn-group">
										{% if environment.managed  %}
											{% include 'elements/get-button.html.twig' with {
												'url': path('index.rebuild', {'id': environment.id}),
												'label': 'Rebuild',
												'icon': 'recycle'
											}%}
										{% else %}
											{% include 'elements/get-button.html.twig' with {
												'url': path('index.switch', {'id': environment.id}),
												'label': 'Switch',
												'icon': 'share-square-o'
											}%}
										{% endif %}
										{% include 'elements/post-button.html.twig' with {
											'url': path('environment.delete', {'id': environment.id}),
											'message': 'Delete the environment ' ~ environment.name|humanize ~ ' ?',
											'label': 'Delete',
											'icon': 'trash'
										}%}
									</div>
								</td>
							</tr>
						{% endfor %}
					</tbody>
				</table>
				{% endif %}
			</div>
			<!-- /.box-body -->
		</div>
	</div>
	
	<div class="col-md-4">
		<div class="box ">
			<div class="box-header with-border">
				<i class="fa fa-database"></i>
				<h3 class="box-title">Orphan indexes</h3>
			</div>
			<!-- /.box-header -->
			<div class="box-body">
			
				{% if orphanIndexes|length == 0 %}
					There is no orphean index
				{% else %}
				
				<table class="table table-condensed table-striped">
					<tbody>
						<tr>
							<th class="text-center" style="width: 10px">#</th>
							<th>Name</th>
							<th class="text-center">Total</th>
							<th>Action</th>
						</tr>
						{% for index in orphanIndexes %}
							<tr>
								<td class="text-center">{{ loop.index }}.</td>
								<td>{{ index.name }}</td>
								<td class="text-center">{{ index.total|number_format }}</td>
								<td>
								{% include 'elements/post-button.html.twig' with {
									'url': path('index.delete', {'name': index.name}),
									'message': 'Delete the index ' ~ index.name|humanize ~ ' ?',
									'label': 'Delete',
									'icon': 'trash'
								}%}
									
								</td>
							</tr>
						{% endfor %}
					</tbody>
				</table>
				{% endif %}

			</div>
			<!-- /.box-body -->
		</div>

		<div class="box ">
			<div class="box-header with-border">
				<i class="fa fa-database"></i>
				<h3 class="box-title">Unmanaged aliases</h3>
			</div>
			<!-- /.box-header -->
			<div class="box-body">
				{% if unmanagedIndexes|length == 0 %}
					All indexes are managed
				{% else %}
			
					<table class="table table-condensed table-striped">
						<tbody>
							<tr>
								<th class="text-center" style="width: 10px">#</th>
								<th>Name</th>
								<th>Index</th>
								<th class="text-center">Total</th>
								<th>Action</th>
							</tr>
							{% for alias in unmanagedIndexes %}
								<tr>
									<td class="text-center">{{ loop.index }}.</td>
									<td>{{ alias.name }}</td>
									<td>{{ alias.index }}</td>
									<td class="text-center">{{ alias.total|number_format }}</td>
									<td>
										{% include 'elements/post-button.html.twig' with {
											'url': path('environment.create', {'name': alias.name }),
											'label': 'Manage',
											'icon': 'plus'
										}%}
									</td>
								</tr>
							{% endfor %}
						</tbody>
					</table>
				{% endif %}

			</div>
			<!-- /.box-body -->
		</div>
	</div>
</div>

{% endblock %} 

{% block javascripts %}
	{% include 'app/menu.html.twig' with {
		'item':  'environment-list'
	}%}
{% endblock %}	
